import{_ as t,W as p,X as l,Y as n,Z as s,$ as e,a0 as o,D as c}from"./framework-b4edc447.js";const i={},u=n("h1",{id:"使用log-pilot收集k8s中的容器日志",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#使用log-pilot收集k8s中的容器日志","aria-hidden":"true"},"#"),s(" 使用log-pilot收集k8s中的容器日志")],-1),r={href:"https://github.com/AliyunContainerService/log-pilot",target:"_blank",rel:"noopener noreferrer"},k={href:"https://yq.aliyun.com/articles/674327",target:"_blank",rel:"noopener noreferrer"},d={href:"https://yq.aliyun.com/articles/674361?spm=a2c4e.11153940.0.0.21ae21c3mTKwWS",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/AliyunContainerService/log-pilot/tree/master/examples",target:"_blank",rel:"noopener noreferrer"},b=o(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> DaemonSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> log<span class="token punctuation">-</span>pilot
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> log<span class="token punctuation">-</span>pilot
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">updateStrategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> log<span class="token punctuation">-</span>pilot
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> log<span class="token punctuation">-</span>pilot
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>    <span class="token comment">###这三行的作用是不会部署到master节点</span>
      <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master   <span class="token comment">###这三行的作用是不会部署到master节点</span>
        <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule    <span class="token comment">###这三行的作用是不会部署到master节点</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> log<span class="token punctuation">-</span>pilot
        <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/acs/log<span class="token punctuation">-</span>pilot<span class="token punctuation">:</span>0.9.7<span class="token punctuation">-</span>filebeat  <span class="token comment">###指定了最新的镜像</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;LOGGING_OUTPUT&quot;</span>
            <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;kafka&quot;</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;KAFKA_BROKERS&quot;</span>
            <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;10.23.140.95:9092&quot;</span> <span class="token comment">###这里指定了传输到kafka的地址</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;NODE_NAME&quot;</span>
            <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
              <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> spec.nodeName
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sock
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/run/docker.sock
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/filebeat
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> state
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/lib/filebeat
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> root
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /host
          <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> localtime
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/localtime
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">capabilities</span><span class="token punctuation">:</span>
            <span class="token key atrule">add</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> SYS_ADMIN
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sock
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/run/docker.sock
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/log/filebeat
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> state
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /var/lib/filebeat
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> root
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> localtime
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/localtime
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动，看他被调度到了哪个节点</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> log-pilot.yaml 
kubectl get pod <span class="token parameter variable">-o</span> wide <span class="token operator">|</span> <span class="token function">grep</span> log-pilot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在启动一个测试用的nginx，来收集nginx的日志做测试。配置文件nginx-test.yaml如下</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>test
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>test
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>test
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodeName</span><span class="token punctuation">:</span> 10.23.190.12
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.21<span class="token punctuation">-</span>alpine
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> aliyun_logs_nginxtest <span class="token comment">###深坑，必须以aliyun_logs为开头</span>
          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;stdout&quot;</span>   <span class="token comment">###这里指定收集容器stdou的输出日志</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>test
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>test
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">38888</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看被调度到了那个工作节点，然后去访问nodePort制造出几条日志</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl get pod <span class="token parameter variable">-o</span> wide <span class="token operator">|</span> <span class="token function">grep</span> nginx-test
kubectl get pod <span class="token parameter variable">-o</span> wide <span class="token operator">|</span> <span class="token function">grep</span> log-pilot  <span class="token comment">###查看一共多少pod</span>
kubectl logs log-pilot-4qj57   <span class="token comment">###然后随机选一个查看日志</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:32:54+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;df6d99038672d8d12098247833bd0b2870f0942c8653bd6c5b7e6d83f823a3e0 has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:32:55+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;8ee1ce523604796d22e4be8e7c2788962f99b7c1f6eac92e479f9f10b5b03ee8 has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:32:55+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;a709830f96d7c8f9f01c74554a2fe1eb9141514b662774faf10ada520abb1e93 has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:32:55+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;44d5dce88d81e88de2ada3c32ced17e566a0d9a6ea8f0e7b4e4dd015d2c0a278 has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:32:55+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;3de0b1a3c3516af10cea7f25906cff26619fc667d7cf02224533c994f53fa247 has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:32:55+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;fcc6b8013ad759df9b8da5a3fb243779c5e5847c02f128c053d16ed6485a2295 has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:32:55+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;69f9c2044b534874dd03ed088bdd5a1fd95257cc956cf2d6c8c26672287dafb8 has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:32:55+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;6cf19d32da0ffe4dfb6bc1bcfc90cbe4010eca17fe75244f0cc10be154b00d6e has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:32:55+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;65fe73be91bfb6773c491d489c56fc0df61f7ba5314e422389394758261af0ac has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:50:20+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;Process container destroy event: 76fc6184a0dc8eeace500f17551c50d13a3aa75c76b90dcdb9fa5117c6caa7fc&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:50:20+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;begin to watch log config: 76fc6184a0dc8eeace500f17551c50d13a3aa75c76b90dcdb9fa5117c6caa7fc.yml&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:50:49+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;Process container destroy event: 81b0c3603f980cbd4b346dfa6bd5c13ac40e723a71ed3bb4bc3930623e572a1b&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:50:49+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;begin to watch log config: 81b0c3603f980cbd4b346dfa6bd5c13ac40e723a71ed3bb4bc3930623e572a1b.yml&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:50:53+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;log config 76fc6184a0dc8eeace500f17551c50d13a3aa75c76b90dcdb9fa5117c6caa7fc.yml has been removed and ignore&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:50:53+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;log config 81b0c3603f980cbd4b346dfa6bd5c13ac40e723a71ed3bb4bc3930623e572a1b.yml has been removed and ignore&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:51:57+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;Process container start event: 89cb27f0040b62c32756939aae91ef231d243fb18ba15a67309fa2da5f8aeaeb&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:51:57+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;89cb27f0040b62c32756939aae91ef231d243fb18ba15a67309fa2da5f8aeaeb has not log config, skip&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:51:58+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;Process container start event: 928fa2dbe79d7617cda619f51c556c91745d3202b8d590395424e920d276fa90&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:51:58+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;ignore checking the validity of kafka topic&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:51:58+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;logs: 928fa2dbe79d7617cda619f51c556c91745d3202b8d590395424e920d276fa90 = &amp;{nginxtest /host/data/kube/docker/containers/928fa2dbe79d7617cda619f51c556c91745d3202b8d590395424e920d276fa90  nonex map[time_format:%Y-%m-%dT%H:%M:%S.%NZ] 928fa2dbe79d7617cda619f51c556c91745d3202b8d590395424e920d276fa90-json.log* map[index:nginxtest topic:nginxtest]  false true}&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:51:58+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;Reload filebeat&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:51:58+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;Start reloading&quot;</span>
<span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token string">&quot;2022-12-08T19:51:58+08:00&quot;</span> <span class="token assign-left variable">level</span><span class="token operator">=</span>debug <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">&quot;do not need to reload filebeat&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),m={href:"https://github.com/AliyunContainerService/log-pilot/issues/235",target:"_blank",rel:"noopener noreferrer"};function g(f,y){const a=c("ExternalLinkIcon");return p(),l("div",null,[u,n("p",null,[s("github地址： "),n("a",r,[s("https://github.com/AliyunContainerService/log-pilot"),e(a)]),s(" log-pilot官方介绍： "),n("a",k,[s("https://yq.aliyun.com/articles/674327"),e(a)]),s(" log-pilot官方搭建： "),n("a",d,[s("https://yq.aliyun.com/articles/674361?spm=a2c4e.11153940.0.0.21ae21c3mTKwWS"),e(a)]),s(" 官方配置文件模版："),n("a",v,[s("https://github.com/AliyunContainerService/log-pilot/tree/master/examples"),e(a)]),s(" 在k8s中启动一个deloyment，配置文件log-pilot.yaml 如下：")]),b,n("p",null,[s("这时候已经不显示has not log config, skip，之前因为没写aliyun_log,pod识别不到要收集的pod，所以一直跳过。 由最后的输出看到，已经正常采集到了，通过kafka-ui看到，topic也成功被创建，后面就是logstash>es的常规操作了。 有的文章说log-pilot不支持es7，但是，最终一套流程下来，我们的es7正常的收集到了日志，展示到了kibana。 "),n("a",m,[s("官方仓库下面有人在讨论这个事"),e(a)]),s("，我猜测他们说的不支持，是不支持log-pilot直接输入到es。")])])}const h=t(i,[["render",g],["__file","使用log-pilot收集k8s中的容器日志.html.vue"]]);export{h as default};
