import{_ as a,W as t,X as o,Y as e,Z as n,$ as r,D as s}from"./framework-b4edc447.js";const i={},_=e("h1",{id:"近半年工作总结",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#近半年工作总结","aria-hidden":"true"},"#"),n(" 近半年工作总结")],-1),h=e("p",null,"安装部署了ELK三主三从高可用集群（三台机器每台运行一个master节点和一个data节点）",-1),p=e("p",null,"ELK部署文档",-1),c=e("li",null,"组件包括filebeat、kafka、kafka的web管理界面kafka-ui、kafka的依赖zookeeper、logstash、elasticsearch、kibana、、elastalert和elastalert2。",-1),u={href:"https://wiki.apple.com/pages/viewpage.action?pageId=220328380",target:"_blank",rel:"noopener noreferrer"},d={href:"https://wiki.apple.com/pages/viewpage.action?pageId=209556104",target:"_blank",rel:"noopener noreferrer"},g={href:"https://wiki.apple.com/pages/viewpage.action?pageId=218337476",target:"_blank",rel:"noopener noreferrer"},f=e("p",null,"ELK收集了网络，ldap，Prometheus，nginx等多方的日志",-1),m=e("li",null,"并利用elastalert2对日志中出现的异常信息进行了监控，并尝试过使用supervisor管理elastalert2对多个日志索引进行监控，最终选用脚本形式管理多个日志索引的监控规则。",-1),k={href:"https://github.com/jertel/elastalert2",target:"_blank",rel:"noopener noreferrer"},b=e("li",null,"在迁移之后的上海机器上搭建了一套用于测试的单点es+kafka+kibana，用于进行新功能和新日志的收集测试。",-1),x=e("li",null,[e("p",null,"重构了Prometheus，改变了之前的单点结构"),e("ol",null,[e("li",null,"三地分别监控，（Azure因为网络原因，在Azure仅监控Azure设备）"),e("li",null,",并且运用Prometheus支持的文件发现功能实现了对配置文件的拆分，解决了单个配置文件长达上万行的问题，"),e("li",null,"安装配置了consul，准备代替现有的文件发现，实现consul的自动发现，批量注册，为后续员工自助添加做准备。")])],-1),I=e("p",null,"Prometheus数据持久化存储",-1),w={href:"https://db-engines.com/en/ranking/time+series+dbms",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/Qihoo360/influx-proxy",target:"_blank",rel:"noopener noreferrer"},y=e("code",null,"remote_storage_adapter，以此来提供influxDB的高可用，但是由此而来集群的复杂度越来越高，不利于稳定运行，方案放弃。",-1),P=e("li",null,"查阅资料后通过修改Prometheus启动参数--storage.tsdb.retention.time，实现了数据的长期存储。",-1),D=e("li",null,[e("p",null,"迁移和升级"),e("ol",null,[e("li",null,"完成了上海的两台机器Prometheus集群中的95和96，数据迁移，服务转移，全部完成，总数据量约2T。"),e("li",null,"另外还有一台公用的机器174，部署有Prometheus和grafana也完整完成迁移至72，利用rsync传输，数据全部保留，总数据量1.5T。"),e("li",null,"为了使用alertmanager最新版功能，从0.23升级到0.24，从而支持设置路由的活跃时间代替原来的路由静默时。"),e("li",null,"grafana数据迁移升级，174机器有srs看板，数据全部迁移至新机器72，为支持alertmanager数据插件升级了grafana，数据全部无损迁移。")])],-1),E=e("p",null,"在日常运维过程中搭建了一些用于简化操作的工具和脚本",-1),A=e("li",null,"ansible用于远程控制机器进行配置文件的重载等操作（操作Prometheus，alertmanager，nginx）",-1),L={href:"https://wiki.apple.com/pages/viewpage.action?pageId=199965136",target:"_blank",rel:"noopener noreferrer"},B={href:"https://svnadmin.insanefactory.com/",target:"_blank",rel:"noopener noreferrer"},K=e("li",null,"编写了配置文件备份脚本，每隔两小时对nginx，Prometheus，alertmanager等配置文件进行备份。",-1),z=e("li",null,"编写脚本定时运行，修改alertmanager配置文件，实现了大小周不同的告警策略切换。",-1),V=e("p",null,"高可用",-1),j={href:"https://wiki.apple.com/pages/viewpage.action?pageId=223390253",target:"_blank",rel:"noopener noreferrer"},N=e("li",null,"Nginx（openresty）代理了Prometheus和elk、告警平台等的常用域名，实现了负载均衡，保证了高可用。",-1),W={href:"http://prometheus-it.int.apple.com/",target:"_blank",rel:"noopener noreferrer"},Z={href:"https://wiki.apple.com/pages/viewpage.action?pageId=220324024",target:"_blank",rel:"noopener noreferrer"},q={href:"https://wiki.apple.com/pages/viewpage.action?pageId=215081045",target:"_blank",rel:"noopener noreferrer"},C=e("li",null,"alertmanager通过参数开启集群模式，能够对产生的告警进行过滤，集群中有五台alertmanager，集群最多能够在四台异常时正常运行。",-1),U=e("p",null,"软件新特性测试",-1),R={href:"https://wiki.apple.com/pages/viewpage.action?pageId=209556175",target:"_blank",rel:"noopener noreferrer"},T=e("li",null,"升级最新版alertmanager实现了对路由活跃时间的控制，编写脚本定时执行修改alertmanager配置文件实现了大小周不同的告警策略切换。",-1),F=e("p",null,"grafana",-1),H={href:"http://10.31.140.28:3000/d/MQWgroiiz/mysql_exporter_dashboard?orgId=1&refresh=1m",target:"_blank",rel:"noopener noreferrer"},M={href:"http://10.31.140.28:3000/d/jrHFmBz4z/redis_exporter_dashboard?orgId=1",target:"_blank",rel:"noopener noreferrer"},Q={href:"http://10.31.140.28:3000/d/jwPKIsniZ/kafka_exporter_dashboard?orgId=1&refresh=5s",target:"_blank",rel:"noopener noreferrer"},Y={href:"http://10.31.140.28:3000/d/EUDnW1C7Z11/quan-bu-yi-chang-xin-xi-gao-jing-kan-ban?orgId=1",target:"_blank",rel:"noopener noreferrer"},O={href:"http://10.31.140.28:3000/d/EUDnW1C7Z11/quan-bu-yi-chang-xin-xi-gao-jing-kan-ban?orgId=1",target:"_blank",rel:"noopener noreferrer"},S={href:"http://10.31.140.28:3000/d/Hm96RKmVZ/prometheus_active-directory_dashboard_datasource_all?orgId=1",target:"_blank",rel:"noopener noreferrer"},X=e("li",null,"配置LDAP，为支持alertmanager数据插件升级grafana至8.5.5，多次迁移，包含看板，设置，用户，群组，全部无损保留。",-1),$=e("li",null,"尝试在grafana显示图片提示，通过插件实现，为了简单美观还是选择在顶部显示文字提示。",-1),G={href:"https://wiki.apple.com/pages/viewpage.action?pageId=223389844",target:"_blank",rel:"noopener noreferrer"};function J(ee,ne){const l=s("ExternalLinkIcon");return t(),o("div",null,[_,e("ol",null,[e("li",null,[h,p,e("ol",null,[c,e("li",null,[e("a",u,[n("Web UI for Apache Kafka安装部署文档"),r(l)]),n("，Kafka-UI 功能齐全且免费，因此作为我们的首选。")]),e("li",null,[e("a",d,[n("elastalert日志告警安装部署文档"),r(l)]),n("，ElastAlert 是 Yelp 公司开源的一套用 Python2.6 写的报警框架，代码长时间未更新，不支持新版本功能。")]),e("li",null,[e("a",g,[n("elastalert2安装配置流程-代替elastalert"),r(l)]),n("，ElastAlert2是github上开源的新版本，项目地址，支持elastalert所有原有功能，代码持续更新。")])])]),e("li",null,[f,e("ol",null,[m,e("li",null,[e("a",k,[n("elastalert2"),r(l)]),n("支持11种报警规则，支持报警聚合，报警抑制，支持多种告警渠道，能够满足各日志方对日志监控的各种需求。")]),b])]),x,e("li",null,[I,e("ol",null,[e("li",null,[n("为了让Prometheus的数据能够持久化存储尝试了influxDB，InfluxDB是一个由InfluxData 开发的开源时序型数据库，在"),e("a",w,[n("DB-Engines Ranking "),r(l)]),n("时序数据库排名第一，")]),e("li",null,[n("新版本influxDB集群模式不再开源，尝试由360开源的"),e("a",v,[n("influx-proxy"),r(l)]),n("和官方提供的"),y]),P])]),D,e("li",null,[E,e("ol",null,[A,e("li",null,[e("a",L,[n("安装配置lsync，实现配置文件自动同步"),r(l)]),n("，高效同步保证了配置文件的一致性，Lysnc封装了inotify和rsync工具，采用了inotify触发机制,通过rsync去差异同步，达到实时的效果。")]),e("li",null,[n("搭建了svn用于版本控制，将配置文件上传到svn，并安装了"),e("a",B,[n("iF.SVNAdmin"),r(l)]),n("，实现了对svn的可视化控制，并配置了LDAP，能够通过域账号登录，为后续员工自助添加做准备。")]),K,z])]),e("li",null,[V,e("ol",null,[e("li",null,[n("搭建了自用的高可用nginx+keepalived集群"),e("a",j,[n("OpenResty+Keepalived组建高可用集群+主从模式"),r(l)])]),N,e("li",null,[n("对部分"),e("a",W,[n("域名链接"),r(l)]),n("了LDAP实现了http基础认证"),e("a",Z,[n("Centos7中nginx集成ldap认证实现静态网页认证"),r(l)])]),e("li",null,[n("通过配置grafana和nginx实现了一个域名通过不同路由可以访问多个grafana"),e("a",q,[n("配置nginx代理grafana实现域名访问"),r(l)])]),C])]),e("li",null,[U,e("ol",null,[e("li",null,[n("对Prometheus的告警组件alertmanager配置文件进行测试优化，测试alertmanager的抑制规则，输出文档"),e("a",R,[n("alertmanager 告警抑制规则测试总结"),r(l)]),n("，当被监控设备大面积出现异常时，能够触发最高级告警抑制其他告警。")]),T])]),e("li",null,[F,e("ol",null,[e("li",null,[n("对工作中用到的组件"),e("a",H,[n("mysql"),r(l)]),n(","),e("a",M,[n("redis"),r(l)]),n(","),e("a",Q,[n("kafka"),r(l)]),n(","),e("a",Y,[n("alertmanager"),r(l)]),n(","),e("a",O,[n("elasticsearch"),r(l)]),n(","),e("a",S,[n("ad"),r(l)]),n("在Prometheus实现了监控，在grafana进行绘制了看板具体展示。")]),X,$])]),e("li",null,[e("p",null,[n("处理日常告警，添加静默，保证机器稳定运行，对机器硬件负载，内存负载定时检查，处理多次配置不足造成的告警，申请磁盘，添加swap分区，挂载磁盘，并输出完整的操作文档"),e("a",G,[n("LVM创建和扩容"),r(l)]),n("。")])])])])}const re=a(i,[["render",J],["__file","近半年工作总结.html.vue"]]);export{re as default};
