import{_ as l,W as t,X as i,Y as s,Z as n,$ as a,a0 as o,D as r}from"./framework-b4edc447.js";const p={},c=s("h1",{id:"elastalert2安装配置流程-代替elastalert",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#elastalert2安装配置流程-代替elastalert","aria-hidden":"true"},"#"),n(" elastalert2安装配置流程-代替elastalert")],-1),d=s("p",null,"之前已经有elastalert的安装配置文档了，虽然经过了测试但是发现部分内置命令无法正常运行，并且不支持新版本kibana，代码仓库长时间没有更新，于是换用新版本的elastalert2.",-1),u={id:"requirements",tabindex:"-1"},v=s("a",{class:"header-anchor",href:"#requirements","aria-hidden":"true"},"#",-1),m={href:"https://elastalert2.readthedocs.io/en/latest/running_elastalert.html#requirements",target:"_blank",rel:"noopener noreferrer"},h=o(`<ul><li>Elasticsearch 7.x or 8.x, or OpenSearch 1.x or 2.x</li><li>ISO8601 or Unix timestamped data</li><li>Python 3.10. Require OpenSSL 1.1.1 or newer.</li><li>pip</li></ul><p>根据官方文档描述，需要升级Python环境到3.10，OPenSSL到1.1.1,事实上在Python3.7之后的版本，依赖的openssl，必须要是1.1或者1.0.2之后的版本。</p><h3 id="开始安装python3-10和openssl" tabindex="-1"><a class="header-anchor" href="#开始安装python3-10和openssl" aria-hidden="true">#</a> 开始安装Python3.10和OpenSSL</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> groupinstall <span class="token string">&quot;Development tools&quot;</span>
<span class="token function">sudo</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel libffi-devel gdbm-devel db4-devel libpcap-devel xz-devel <span class="token function">make</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> zlib* <span class="token parameter variable">-y</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> gcc gcc-c++ python-devel <span class="token function">wget</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> zlib zlib-dev openssl-devel sqlite-devel bzip2-devel libffi libffi-devel gcc gcc-c++

<span class="token function">wget</span> https://www.openssl.org/source/openssl-1.1.1k.tar.gz

./config <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/openssl shared zlib 
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>

<span class="token function">mv</span> /usr/bin/openssl /usr/bin/openssl.bak <span class="token comment">#备份当前openssl</span>
<span class="token function">mv</span> /usr/include/openssl /usr/include/openssl.bak 

<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/openssl/bin/openssl /usr/bin/openssl <span class="token comment">#配置使用新版本</span>
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/openssl/include/openssl /usr/include/openssl

<span class="token builtin class-name">echo</span> /usr/local/openssl/lib <span class="token operator">&gt;&gt;</span> /etc/ld.so.conf   <span class="token comment">#更新动态链接库数据并重新加载</span>
ldconfig <span class="token parameter variable">-v</span>

openssl version <span class="token comment">#查看是否升级成功</span>

<span class="token function">wget</span> https://www.python.org/ftp/python/3.10.4/Python-3.10.4.tgz

<span class="token function">sudo</span> ./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/python3 --with-ssl<span class="token operator">=</span>/usr/local/openssl

<span class="token function">sudo</span> <span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">make</span> clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装完成可能会出现" tabindex="-1"><a class="header-anchor" href="#安装完成可能会出现" aria-hidden="true">#</a> 安装完成可能会出现</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>WARNING: pip is configured with locations that require TLS/SSL, however the ssl module <span class="token keyword">in</span> Python is not available.
Could not fetch URL https://pypi.org/simple/pip/: There was a problem confirming the ssl certificate: HTTPSConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">&#39;pypi.org&#39;</span>, <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">443</span><span class="token punctuation">)</span>: Max retries exceeded with url: /simple/pip/ <span class="token punctuation">(</span>Caused by SSLError<span class="token punctuation">(</span><span class="token string">&quot;Can&#39;t connect to HTTPS URL because the SSL module is not available.&quot;</span><span class="token punctuation">))</span> - skipping
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改完善" tabindex="-1"><a class="header-anchor" href="#修改完善" aria-hidden="true">#</a> 修改完善</h3><p>需要修改<code>vim /tmp/softwarebak/Python-3.10.4/Modules/Setup</code>在末尾加入一下内容</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>_socket socketmodule.c
# Socket module helper for SSL support; you must comment out the other
# socket line above, and possibly edit the SSL variable:
SSL=/usr/local/openssl
_ssl _ssl.c \\
        -DUSE_SSL -I$(SSL)/include -I$(SSL)/include/openssl \\
        -L$(SSL)/lib -lssl -lcrypto
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="重新编译安装python" tabindex="-1"><a class="header-anchor" href="#重新编译安装python" aria-hidden="true">#</a> 重新编译安装Python</h3>`,10),b={href:"https://elastalert2.readthedocs.io/en/latest/running_elastalert.html#as-a-python-package",target:"_blank",rel:"noopener noreferrer"};function k(f,_){const e=r("ExternalLinkIcon");return t(),i("div",null,[c,d,s("h3",u,[v,n(),s("a",m,[n("Requirements"),a(e)])]),h,s("p",null,[n("安装elastalert2具体流程，请看"),s("a",b,[n("官方文档"),a(e)])])])}const S=l(p,[["render",k],["__file","elastalert2安装配置流程-代替elastalert.html.vue"]]);export{S as default};
