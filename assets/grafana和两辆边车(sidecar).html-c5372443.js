import{_ as e,W as t,X as p,Y as n,Z as a,$ as o,a0 as c,D as l}from"./framework-b4edc447.js";const u={},i=c(`<h1 id="grafana和两辆边车-sidecar" tabindex="-1"><a class="header-anchor" href="#grafana和两辆边车-sidecar" aria-hidden="true">#</a> grafana和两辆边车(sidecar)</h1><blockquote><p>在Kubernetes中，Sidecar是一种部署模式，它可以在同一个Pod中运行多个容器，其中一个是主容器，其他的容器则是Sidecar容器，用来提供一些辅助功能。</p><p>常见的Sidecar使用场景包括：</p><p>日志收集：在一个Pod中运行一个主应用程序和一个日志收集器Sidecar，通过共享Pod内的数据卷，让日志收集器能够收集主应用程序产生的日志信息。</p><p>数据同步：在一个Pod中运行一个主应用程序和一个数据同步器Sidecar，数据同步器可以将主应用程序产生的数据同步到其他地方（如外部存储或者其他Pod）。</p><p>健康检查：在一个Pod中运行一个主应用程序和一个健康检查Sidecar，通过检查主应用程序的状态，来保证应用程序的可用性和稳定性。</p><p>在Kubernetes中，可以通过在同一个Pod中定义多个容器来实现Sidecar的部署模式。每个容器都可以访问Pod的共享网络和存储，从而实现数据的共享和交互。需要注意的是，不同容器之间的生命周期是独立的，它们可以独立启动、停止和重启。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>
<span class="token operator">&gt;</span> kubectl get pod
NAME                                                     READY   STATUS    RESTARTS        AGE
alertmanager-prometheus-kube-prometheus-alertmanager-0   <span class="token number">2</span>/2     Running   <span class="token number">3</span> <span class="token punctuation">(</span>4m47s ago<span class="token punctuation">)</span>   2d17h
prometheus-grafana-656c669c85-49r55                      <span class="token number">3</span>/3     Running   <span class="token number">3</span> <span class="token punctuation">(</span>4m47s ago<span class="token punctuation">)</span>   2d17h
prometheus-kube-prometheus-operator-57674644fc-qd9zm     <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>4m47s ago<span class="token punctuation">)</span>   2d17h
prometheus-kube-state-metrics-745879484f-rpl62           <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>4m47s ago<span class="token punctuation">)</span>   2d17h
prometheus-prometheus-kube-prometheus-prometheus-0       <span class="token number">2</span>/2     Running   <span class="token number">2</span> <span class="token punctuation">(</span>4m47s ago<span class="token punctuation">)</span>   2d17h
prometheus-prometheus-node-exporter-2mnlv                <span class="token number">1</span>/1     Running   <span class="token number">1</span> <span class="token punctuation">(</span>4m47s ago<span class="token punctuation">)</span>   2d17h

/Users/user.^_^.<span class="token punctuation">[</span><span class="token number">10</span>:55:06<span class="token punctuation">]</span>
<span class="token operator">&gt;</span> kubectl get rs
NAME                                             DESIRED   CURRENT   READY   AGE
prometheus-grafana-656c669c85                    <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       2d17h
prometheus-kube-prometheus-operator-57674644fc   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       2d17h
prometheus-kube-state-metrics-745879484f         <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       2d17h

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="疑问-这grafana的rs里面的desired不是一个吗-为啥pod的ready有三个呢" tabindex="-1"><a class="header-anchor" href="#疑问-这grafana的rs里面的desired不是一个吗-为啥pod的ready有三个呢" aria-hidden="true">#</a> 疑问：这grafana的rs里面的desired不是一个吗？为啥pod的ready有三个呢</h3><p>群里高人指点，这里的三个并不是指数是三个，而是显示这个pod里面的三个容器都是ready的，并且在running状态</p><p>之所以会有三个容器，可能是这个pod里面有init的容器，或者sidecar的容器。你可以通过desribe查看详细的信息。</p><p>下面是<code>kubectl desribe pod prometheus-grafana-656c669c85-49r55</code>的部分输出</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">Containers</span><span class="token punctuation">:</span>
  <span class="token key atrule">grafana-sc-dashboard</span><span class="token punctuation">:</span>
    <span class="token key atrule">Container ID</span><span class="token punctuation">:</span>   docker<span class="token punctuation">:</span>//8e5d3339b69445394c70ecd5b1b1a2009ff7d71fa835019d181eccd434931648
    <span class="token key atrule">Image</span><span class="token punctuation">:</span>          quay.io/kiwigrid/k8s<span class="token punctuation">-</span>sidecar<span class="token punctuation">:</span>1.22.0
    <span class="token key atrule">Image ID</span><span class="token punctuation">:</span>       docker<span class="token punctuation">-</span>pullable<span class="token punctuation">:</span>//quay.io/kiwigrid/k8s<span class="token punctuation">-</span>sidecar@sha256<span class="token punctuation">:</span>eaa478cdd0b8e1be7a4813bc1b01948b838e2feaa6d999e60c997dc823013824
    <span class="token key atrule">Port</span><span class="token punctuation">:</span>           &lt;none<span class="token punctuation">&gt;</span>
    <span class="token key atrule">Host Port</span><span class="token punctuation">:</span>      &lt;none<span class="token punctuation">&gt;</span>
    <span class="token key atrule">State</span><span class="token punctuation">:</span>          Running
      <span class="token key atrule">Started</span><span class="token punctuation">:</span>      Fri<span class="token punctuation">,</span> 17 Mar 2023 10<span class="token punctuation">:</span>50<span class="token punctuation">:</span>39 +0800
    <span class="token key atrule">Last State</span><span class="token punctuation">:</span>     Terminated
      <span class="token key atrule">Reason</span><span class="token punctuation">:</span>       Error
      <span class="token key atrule">Exit Code</span><span class="token punctuation">:</span>    <span class="token number">255</span>
      <span class="token key atrule">Started</span><span class="token punctuation">:</span>      Tue<span class="token punctuation">,</span> 14 Mar 2023 17<span class="token punctuation">:</span>20<span class="token punctuation">:</span>31 +0800
      <span class="token key atrule">Finished</span><span class="token punctuation">:</span>     Fri<span class="token punctuation">,</span> 17 Mar 2023 10<span class="token punctuation">:</span>50<span class="token punctuation">:</span>19 +0800
    <span class="token key atrule">Ready</span><span class="token punctuation">:</span>          <span class="token boolean important">True</span>
    <span class="token key atrule">Restart Count</span><span class="token punctuation">:</span>  <span class="token number">1</span>
    <span class="token key atrule">Environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">METHOD</span><span class="token punctuation">:</span>        WATCH
      <span class="token key atrule">LABEL</span><span class="token punctuation">:</span>         grafana_dashboard
      <span class="token key atrule">LABEL_VALUE</span><span class="token punctuation">:</span>   <span class="token number">1</span>
      <span class="token key atrule">FOLDER</span><span class="token punctuation">:</span>        /tmp/dashboards
      <span class="token key atrule">RESOURCE</span><span class="token punctuation">:</span>      both
      <span class="token key atrule">REQ_USERNAME</span><span class="token punctuation">:</span>  <span class="token key atrule">&lt;set to the key &#39;admin-user&#39; in secret &#39;prometheus-grafana&#39;&gt;      Optional</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">REQ_PASSWORD</span><span class="token punctuation">:</span>  <span class="token key atrule">&lt;set to the key &#39;admin-password&#39; in secret &#39;prometheus-grafana&#39;&gt;  Optional</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">REQ_URL</span><span class="token punctuation">:</span>       http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3000/api/admin/provisioning/dashboards/reload
      <span class="token key atrule">REQ_METHOD</span><span class="token punctuation">:</span>    POST
    <span class="token key atrule">Mounts</span><span class="token punctuation">:</span>
      /tmp/dashboards from sc<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>volume (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube<span class="token punctuation">-</span>api<span class="token punctuation">-</span>access<span class="token punctuation">-</span>zf92v (ro)
  <span class="token key atrule">grafana-sc-datasources</span><span class="token punctuation">:</span>
    <span class="token key atrule">Container ID</span><span class="token punctuation">:</span>   docker<span class="token punctuation">:</span>//e238e224b843a386e9c38f71cf3a9e7c8854413088a6b03b25b15ba3e7d56790
    <span class="token key atrule">Image</span><span class="token punctuation">:</span>          quay.io/kiwigrid/k8s<span class="token punctuation">-</span>sidecar<span class="token punctuation">:</span>1.22.0
    <span class="token key atrule">Image ID</span><span class="token punctuation">:</span>       docker<span class="token punctuation">-</span>pullable<span class="token punctuation">:</span>//quay.io/kiwigrid/k8s<span class="token punctuation">-</span>sidecar@sha256<span class="token punctuation">:</span>eaa478cdd0b8e1be7a4813bc1b01948b838e2feaa6d999e60c997dc823013824
    <span class="token key atrule">Port</span><span class="token punctuation">:</span>           &lt;none<span class="token punctuation">&gt;</span>
    <span class="token key atrule">Host Port</span><span class="token punctuation">:</span>      &lt;none<span class="token punctuation">&gt;</span>
    <span class="token key atrule">State</span><span class="token punctuation">:</span>          Running
      <span class="token key atrule">Started</span><span class="token punctuation">:</span>      Fri<span class="token punctuation">,</span> 17 Mar 2023 10<span class="token punctuation">:</span>50<span class="token punctuation">:</span>39 +0800
    <span class="token key atrule">Last State</span><span class="token punctuation">:</span>     Terminated
      <span class="token key atrule">Reason</span><span class="token punctuation">:</span>       Error
      <span class="token key atrule">Exit Code</span><span class="token punctuation">:</span>    <span class="token number">255</span>
      <span class="token key atrule">Started</span><span class="token punctuation">:</span>      Tue<span class="token punctuation">,</span> 14 Mar 2023 17<span class="token punctuation">:</span>20<span class="token punctuation">:</span>31 +0800
      <span class="token key atrule">Finished</span><span class="token punctuation">:</span>     Fri<span class="token punctuation">,</span> 17 Mar 2023 10<span class="token punctuation">:</span>50<span class="token punctuation">:</span>19 +0800
    <span class="token key atrule">Ready</span><span class="token punctuation">:</span>          <span class="token boolean important">True</span>
    <span class="token key atrule">Restart Count</span><span class="token punctuation">:</span>  <span class="token number">1</span>
    <span class="token key atrule">Environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">METHOD</span><span class="token punctuation">:</span>        WATCH
      <span class="token key atrule">LABEL</span><span class="token punctuation">:</span>         grafana_datasource
      <span class="token key atrule">LABEL_VALUE</span><span class="token punctuation">:</span>   <span class="token number">1</span>
      <span class="token key atrule">FOLDER</span><span class="token punctuation">:</span>        /etc/grafana/provisioning/datasources
      <span class="token key atrule">RESOURCE</span><span class="token punctuation">:</span>      both
      <span class="token key atrule">REQ_USERNAME</span><span class="token punctuation">:</span>  <span class="token key atrule">&lt;set to the key &#39;admin-user&#39; in secret &#39;prometheus-grafana&#39;&gt;      Optional</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">REQ_PASSWORD</span><span class="token punctuation">:</span>  <span class="token key atrule">&lt;set to the key &#39;admin-password&#39; in secret &#39;prometheus-grafana&#39;&gt;  Optional</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">REQ_URL</span><span class="token punctuation">:</span>       http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3000/api/admin/provisioning/datasources/reload
      <span class="token key atrule">REQ_METHOD</span><span class="token punctuation">:</span>    POST
    <span class="token key atrule">Mounts</span><span class="token punctuation">:</span>
      /etc/grafana/provisioning/datasources from sc<span class="token punctuation">-</span>datasources<span class="token punctuation">-</span>volume (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube<span class="token punctuation">-</span>api<span class="token punctuation">-</span>access<span class="token punctuation">-</span>zf92v (ro)
  <span class="token key atrule">grafana</span><span class="token punctuation">:</span>
    <span class="token key atrule">Container ID</span><span class="token punctuation">:</span>   docker<span class="token punctuation">:</span>//28cfae89d966a86d9deb73fb36bf7fd5784b972b8115067b1baa63aab327bc36
    <span class="token key atrule">Image</span><span class="token punctuation">:</span>          grafana/grafana<span class="token punctuation">:</span>9.3.8
    <span class="token key atrule">Image ID</span><span class="token punctuation">:</span>       docker<span class="token punctuation">-</span>pullable<span class="token punctuation">:</span>//grafana/grafana@sha256<span class="token punctuation">:</span>a49f7d74630f47507e7e1ba92f6204f3c7b525d17108a90d489294030a9d507a
    <span class="token key atrule">Ports</span><span class="token punctuation">:</span>          3000/TCP<span class="token punctuation">,</span> 9094/TCP<span class="token punctuation">,</span> 9094/UDP
    <span class="token key atrule">Host Ports</span><span class="token punctuation">:</span>     0/TCP<span class="token punctuation">,</span> 0/TCP<span class="token punctuation">,</span> 0/UDP
    <span class="token key atrule">State</span><span class="token punctuation">:</span>          Running
      <span class="token key atrule">Started</span><span class="token punctuation">:</span>      Fri<span class="token punctuation">,</span> 17 Mar 2023 10<span class="token punctuation">:</span>50<span class="token punctuation">:</span>39 +0800
    <span class="token key atrule">Last State</span><span class="token punctuation">:</span>     Terminated
      <span class="token key atrule">Reason</span><span class="token punctuation">:</span>       Error
      <span class="token key atrule">Exit Code</span><span class="token punctuation">:</span>    <span class="token number">255</span>
      <span class="token key atrule">Started</span><span class="token punctuation">:</span>      Tue<span class="token punctuation">,</span> 14 Mar 2023 17<span class="token punctuation">:</span>22<span class="token punctuation">:</span>09 +0800
      <span class="token key atrule">Finished</span><span class="token punctuation">:</span>     Fri<span class="token punctuation">,</span> 17 Mar 2023 10<span class="token punctuation">:</span>50<span class="token punctuation">:</span>19 +0800
    <span class="token key atrule">Ready</span><span class="token punctuation">:</span>          <span class="token boolean important">True</span>
    <span class="token key atrule">Restart Count</span><span class="token punctuation">:</span>  <span class="token number">1</span>
    <span class="token key atrule">Liveness</span><span class="token punctuation">:</span>       http<span class="token punctuation">-</span>get http<span class="token punctuation">:</span>//<span class="token punctuation">:</span>3000/api/health delay=60s timeout=30s period=10s <span class="token comment">#success=1 #failure=10</span>
    <span class="token key atrule">Readiness</span><span class="token punctuation">:</span>      http<span class="token punctuation">-</span>get http<span class="token punctuation">:</span>//<span class="token punctuation">:</span>3000/api/health delay=0s timeout=1s period=10s <span class="token comment">#success=1 #failure=3</span>
    <span class="token key atrule">Environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">POD_IP</span><span class="token punctuation">:</span>                       (v1<span class="token punctuation">:</span>status.podIP)
      <span class="token key atrule">GF_SECURITY_ADMIN_USER</span><span class="token punctuation">:</span>      <span class="token key atrule">&lt;set to the key &#39;admin-user&#39; in secret &#39;prometheus-grafana&#39;&gt;      Optional</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">GF_SECURITY_ADMIN_PASSWORD</span><span class="token punctuation">:</span>  <span class="token key atrule">&lt;set to the key &#39;admin-password&#39; in secret &#39;prometheus-grafana&#39;&gt;  Optional</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">GF_PATHS_DATA</span><span class="token punctuation">:</span>               /var/lib/grafana/
      <span class="token key atrule">GF_PATHS_LOGS</span><span class="token punctuation">:</span>               /var/log/grafana
      <span class="token key atrule">GF_PATHS_PLUGINS</span><span class="token punctuation">:</span>            /var/lib/grafana/plugins
      <span class="token key atrule">GF_PATHS_PROVISIONING</span><span class="token punctuation">:</span>       /etc/grafana/provisioning
    <span class="token key atrule">Mounts</span><span class="token punctuation">:</span>
      /etc/grafana/grafana.ini from config (rw<span class="token punctuation">,</span>path=&quot;grafana.ini&quot;)
      /etc/grafana/provisioning/dashboards/sc<span class="token punctuation">-</span>dashboardproviders.yaml from sc<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>provider (rw<span class="token punctuation">,</span>path=&quot;provider.yaml&quot;)
      /etc/grafana/provisioning/datasources from sc<span class="token punctuation">-</span>datasources<span class="token punctuation">-</span>volume (rw)
      /tmp/dashboards from sc<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>volume (rw)
      /var/lib/grafana from storage (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube<span class="token punctuation">-</span>api<span class="token punctuation">-</span>access<span class="token punctuation">-</span>zf92v (ro)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到是有两个sidecar的容器的并且容器的名字也是很符合我的命名规范，也就是见名知义 <code>grafana-sc-datasources</code>,意思是grafana的pod的sidecar容器，作用是用于挂载grafana的datasource，一个名字，直接把我一开始的疑问都给解开了。</p><p><s>想起来同事写的Python代码，我问他为什么这个instance后面要写一个17呢？他给我的回答是&quot;因为我喜欢17这个数字&quot;，我看你就是喜欢未成年的！！！</s></p><p>就是说为什么grafana的pod里面为什么会有三个容器呢，一个是sidecar挂载datasource，一个是sidecar挂载dashboard，有了这两个，才能让你在第一次打开grafana时，数据源和看板都是配置好了的。</p><p>以下两两段引用自chatGPT</p>`,12),r={href:"http://quay.io/kiwigrid/k8s-sidecar:1.22.0",target:"_blank",rel:"noopener noreferrer"},k=n("p",null,"这个镜像是由 kiwigrid 团队开发的，其主要特点包括：",-1),d=n("ul",null,[n("li",null,"基于 Alpine Linux 3.14.1 构建，镜像大小仅为 8.82 MB。"),n("li",null,"支持多种监控方式，包括 Prometheus、Grafana 和 InfluxDB 等。"),n("li",null,"可以轻松地与 Kubernetes 网络和存储系统进行集成。"),n("li",null,"支持动态配置，允许在不停止应用程序的情况下更新配置。"),n("li",null,"可以在应用程序容器旁边作为 Sidecar 容器运行，实现应用程序的监控和管理。")],-1),v=n("p",null,"这个镜像主要用于实现 Kubernetes 中的 Sidecar 模式，即将一个或多个辅助容器部署在主应用程序容器旁边，以协同工作或提供额外的功能。Sidecar 模式可以简化应用程序的监控和管理，同时提高应用程序的可靠性和可维护性。",-1),m=n("p",null,"不是真的不知道sidecar是啥，而是在遇到问题，解决问题的路上发现，哦，原来是这小子，之所以本文标题取这个名字是因为当你使用翻译软件翻译英文文档时，sidecar真的就会被翻译成边车，哈哈哈，很逗，但也真不知道有啥更好的选择了。",-1);function b(y,g){const s=l("ExternalLinkIcon");return t(),p("div",null,[i,n("blockquote",null,[n("p",null,[n("a",r,[a("quay.io/kiwigrid/k8s-sidecar:1.22.0"),o(s)]),a(" 是一个 Kubernetes Sidecar 容器的镜像，主要用于在 Kubernetes 中实现应用程序的监控和管理。")]),k,d,v]),m])}const f=e(u,[["render",b],["__file","grafana和两辆边车(sidecar).html.vue"]]);export{f as default};
